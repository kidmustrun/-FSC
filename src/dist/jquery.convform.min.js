function SingleConvState(t){return this.input=t,this.answer="",this.next=!1,this}function ConvState(t,e,i,s,n){this.form=i,this.wrapper=t,this.current=e,this.answers={},this.parameters=s,this.originalFormHtml=n,this.scrollDown=function(){$(this.wrapper).find("#messages").stop().animate({scrollTop:$(this.wrapper).find("#messages")[0].scrollHeight},600)}.bind(this)}SingleConvState.prototype.hasNext=function(){return this.next},ConvState.prototype.next=function(){if(this.current.hasNext()){if(this.current=this.current.next,this.current.input.hasOwnProperty("fork")&&this.current.input.hasOwnProperty("case")){if(this.answers.hasOwnProperty(this.current.input.fork)&&this.answers[this.current.input.fork].value!=this.current.input.case)return this.next();if(!this.answers.hasOwnProperty(this.current.input.fork))return this.next()}return!0}return!1},ConvState.prototype.printQuestion=function(){var t=this.current.input.questions,e=t[Math.floor(Math.random()*t.length)],i=$(this.wrapper).find(".message.typing");setTimeout(function(){i.html(e);var t=-1*($(i).height()+15);$(i).append($('<svg id="site" class="bi bi-circle" width="2em" height="2em" viewBox="0 0 16 16" fill="rgb(84, 153, 42)" xmlns="http://www.w3.org/2000/svg" style="margin-top:'+t+'px;"><path fill-rule="nonzero" fill="white"  d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z" clip-rule="evenodd"/><image x="2" y="2" width="12" height="12" xlink:href="media/site.png"></svg>')),i.removeClass("typing").addClass("ready"),"select"==this.current.input.type&&this.printAnswers(this.current.input.answers,this.current.input.multiple),this.scrollDown(),this.current.input.hasOwnProperty("noAnswer")&&!0===this.current.input.noAnswer&&(this.next()?setTimeout(function(){var t=$('<div class="message to typing"><div class="typing_loader"></div></div>');$(this.wrapper).find("#messages").append(t),this.scrollDown(),this.printQuestion()}.bind(this),200):this.parameters.eventList.onSubmitForm(this)),$(this.wrapper).find(this.parameters.inputIdHashTagName).focus()}.bind(this),500)},ConvState.prototype.printAnswers=function(t,e){var i;for(var s in t){t.hasOwnProperty(s)&&(i=$('<div class="option">'+t[s].text+"</div>").data("answer",t[s]).click(function(t){this.current.input.selected=$(t.target).data("answer").value,this.wrapper.find(this.parameters.inputIdHashTagName).removeClass("error"),this.wrapper.find(this.parameters.inputIdHashTagName).val(""),this.answerWith($(t.target).data("answer").text,$(t.target).data("answer")),this.wrapper.find("div.options div.option").remove()}.bind(this)),this.wrapper.find("div.options").append(i))}var n=$(this.wrapper).find("div.options").height(),r=$(this.wrapper).find(".wrapper-messages").height();$(this.wrapper).find(".wrapper-messages").data("originalHeight",r),$(this.wrapper).find(".wrapper-messages").css({marginBottom:n,maxHeight:r-n})},ConvState.prototype.answerWith=function(t,e){this.current.input.hasOwnProperty("name")&&("string"!=typeof e&&(this.answers[this.current.input.name]=e,this.current.answer=e),"select"==this.current.input.type||this.current.input.multiple||$(this.current.input.element).val(e).change()),"password"==this.current.input.type&&(t=t.replace(/./g,"*"));var i=$('<div class="message from"><svg id="rec" class="bi bi-circle" width="2em" height="2em" viewBox="0 0 16 16" fill="rgb(84, 153, 42)" xmlns="http://www.w3.org/2000/svg"><path fill-rule="nonzero" fill="white"  d="M8 15A7 7 0 108 1a7 7 0 000 14zm0 1A8 8 0 108 0a8 8 0 000 16z" clip-rule="evenodd"/><image x="2" y="2" width="12" height="12" xlink:href="media/rec.png"></svg>'+t+"</div>");$(this.wrapper).find("div.options div.option").remove();var s=$(this.wrapper).find("div.options").height(),n=$(this.wrapper).find(".wrapper-messages").data("originalHeight");$(this.wrapper).find(".wrapper-messages").css({marginBottom:s,maxHeight:n}),$(this.wrapper).find(this.parameters.inputIdHashTagName).focus(),e.hasOwnProperty("callback")&&(this.current.input.callback=e.callback),setTimeout(function(){$(this.wrapper).find("#messages").append(i),this.scrollDown()}.bind(this),100),$(this.form).append(this.current.input.element);var r=$('<div class="message to typing"><div class="typing_loader"></div></div>');setTimeout(function(){$(this.wrapper).find("#messages").append(r),this.scrollDown()}.bind(this),150),this.parameters.eventList.onInputSubmit(this,function(){this.next()?setTimeout(function(){this.printQuestion()}.bind(this),300):this.parameters.eventList.onSubmitForm(this)}.bind(this))},function(h){h.fn.convform=function(t){var e=this,i=h(e).html();h(this).addClass("conv-form-wrapper");var s=h.extend(!0,{},{typeInputUi:"textarea",timeOutFirstQuestion:600,eventList:{onSubmitForm:function(t){return console.log("completed"),t.form.submit(),!0},onInputSubmit:function(t,e){t.current.input.hasOwnProperty("callback")?"string"==typeof t.current.input.callback&&window[t.current.input.callback](t,e):e()}}},t),n=h(this).find("input, select, textarea").map(function(){var t={};return h(this).attr("name")&&(t.name=h(this).attr("name")),t.questions=h(this).attr("data-conv-question").split("|"),h(this).is("select")&&(t.type="select",t.answers=h(this).find("option").map(function(){var t={};return t.text=h(this).text(),t.value=h(this).val(),h(this).attr("data-callback")&&(t.callback=h(this).attr("data-callback")),t}).get()),h(this).parent("div[data-conv-case]").length&&(t.case=h(this).parent("div[data-conv-case]").attr("data-conv-case"),t.fork=h(this).parent("div[data-conv-case]").parent("div[data-conv-fork]").attr("data-conv-fork")),t}).get();if(n.length){var r=h(e).find("form").hide();switch(s.typeInputUi){case"textarea":inputForm=h('<form id="'+s.formIdName+'" class="convFormDynamic"><div class="options dragscroll"></div><textarea id="'+s.inputIdName+'" rows="1" placeholder="'+s.placeHolder+'" class="userInputDynamic"></textarea><button type="submit" class="submit">'+s.buttonText+'</button><span class="clear"></span></form>')}h(e).append('<div class="wrapper-messages"><div class="spinLoader '+s.loadSpinnerVisible+' "></div><div id="messages"></div></div>'),h(e).append(inputForm);var a=new SingleConvState(n[0]),p=new ConvState(e,a,r,s,i);for(var o in n)0!=o&&n.hasOwnProperty(o)&&(a.next=new SingleConvState(n[o]),a=a.next);return setTimeout(function(){h.when(h("div.spinLoader").addClass("hidden")).done(function(){var t=h('<div class="message to typing"><div class="typing_loader"></div></div>');h(p.wrapper).find("#messages").append(t),p.scrollDown(),p.printQuestion()})},s.timeOutFirstQuestion),p}return!1}}(jQuery);
